name: Deploy to DigitalOcean
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'
    
    - name: Set environment variables
      env:
        DIGITALOCEAN_HOST: ${{ secrets.DIGITALOCEAN_HOST }}
        DIGITALOCEAN_USERNAME: ${{ secrets.DIGITALOCEAN_USERNAME }}
        SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      run: |
        echo "DIGITALOCEAN_HOST=$DIGITALOCEAN_HOST" >> $GITHUB_ENV
        echo "DIGITALOCEAN_USERNAME=$DIGITALOCEAN_USERNAME" >> $GITHUB_ENV
        echo "SSH_PRIVATE_KEY=$SSH_PRIVATE_KEY" >> $GITHUB_ENV

    - name: Deploy to DigitalOcean
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DIGITALOCEAN_HOST }}
        username: ${{ secrets.DIGITALOCEAN_USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          cd /var/www/html
          npm -v
    # - name: Print secret value
    #   run: |
    #     echo "::set-output name=digitalocean_host::${{ secrets.DIGITALOCEAN_HOST }}"
    #     echo "::set-output name=digitalocean_username::${{ secrets.DIGITALOCEAN_USERNAME }}"

    # - name: Checkout versions
    #   run: npm -v && node -v

    # - name: Deploy to DigitalOcean
    #   uses: appleboy/ssh-action@master
    #   with:
    #     host: ${{ secrets.DIGITALOCEAN_HOST }}
    #     username: ${{ secrets.DIGITALOCEAN_USERNAME }}
    #     key: ${{ secrets.SSH_PRIVATE_KEY }}
    #     script: |
    #       cd /var/www/html
    #       npm install
    #       npm run build